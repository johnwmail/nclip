<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paste - nclip</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline; margin-right: 0.5rem;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                nclip
            </h1>
            <p><a href="/">← Back to Upload</a></p>
        </header>

        <main>
            <div class="paste-info">
                <h2>Paste Details</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>ID:</label>
                        <span>{{.Paste.ID}}</span>
                    </div>
                    <div class="info-item">
                        <label>Size:</label>
                        <span>{{.Paste.Size}} bytes</span>
                    </div>
                    <div class="info-item">
                        <label>Type:</label>
                        <span>{{.Paste.ContentType}}</span>
                    </div>
                    <div class="info-item">
                        <label>Created:</label>
                        <span>{{.Paste.CreatedAt.Format "2006-01-02 15:04:05"}}</span>
                    </div>
                    {{if .Paste.ExpiresAt}}
                    <div class="info-item">
                        <label>Expires:</label>
                        <span>{{.Paste.ExpiresAt.Format "2006-01-02 15:04:05"}}</span>
                    </div>
                    {{end}}
                    {{if .Paste.BurnAfterRead}}
                    <div class="info-item burn-notice">
                        <label>⚠️ Burn After Read:</label>
                        <span>This paste will be deleted after viewing</span>
                    </div>
                    {{end}}
                </div>
            </div>

            <div class="content-section">
                <div class="content-header">
                    <h3>Content</h3>
                    <div class="content-actions">
                        <a href="/raw/{{.Paste.ID}}" class="btn btn-secondary" download>Download</a>
                        <button id="copy-content" class="btn btn-secondary">Copy</button>
                    </div>
                </div>
                
                {{if .IsText}}
                <div class="content-display">
                    <pre id="content-text"><code>{{.Content}}</code></pre>
                </div>
                {{else}}
                <div class="binary-notice">
                    <p>This is a binary file. <a href="/raw/{{.Paste.ID}}">Download</a> to view.</p>
                </div>
                {{end}}
            </div>
        </main>

        <footer>
            <p>nclip - Open source clipboard service</p>
        </footer>
    </div>

    <script>
        // Copy content functionality
        document.getElementById('copy-content')?.addEventListener('click', function() {
            const contentText = document.getElementById('content-text');
            if (contentText) {
                const textToCopy = contentText.textContent || contentText.innerText;
                
                // Try modern clipboard API first
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(textToCopy).then(function() {
                        showCopySuccess();
                    }).catch(function(err) {
                        console.error('Clipboard API failed:', err);
                        fallbackCopy(textToCopy);
                    });
                } else {
                    // Fallback for older browsers or non-HTTPS
                    fallbackCopy(textToCopy);
                }
            }
        });
        
        function showCopySuccess() {
            const btn = document.getElementById('copy-content');
            if (btn) {
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('btn-success');
                setTimeout(function() {
                    btn.textContent = originalText;
                    btn.classList.remove('btn-success');
                }, 2000);
            }
        }
        
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess();
                } else {
                    console.error('Fallback copy failed');
                    alert('Copy failed. Please select and copy manually.');
                }
            } catch (err) {
                console.error('Fallback copy error:', err);
                alert('Copy failed. Please select and copy manually.');
            } finally {
                document.body.removeChild(textArea);
            }
        }
    </script>
</body>
</html>