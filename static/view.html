<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container{{if or .Error (not .Paste)}} no-paste{{end}}">
        <header>
            <h1>
                <a href="/"
                    style="text-decoration: none; color: inherit; display: inline-flex; align-items: center; gap: 0.5rem;">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        style="width: 2rem; height: 2rem; flex-shrink: 0;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    NCLIP
                </a>
            </h1>
            <p>Open Source Clipboard Service</p>
        </header>

        <main>
            <div id="paste-view-section">
                {{/* Show a prominent banner when there's an explicit error or when no paste data is available
                (covers non-existing slug and second read of burn-after-read). */}}
                {{/* If there's an error or no paste, show a large friendly banner and a single content area.
                When a paste exists, show the normal details + content. */}}
                {{if or .Error (not .Paste)}}
                <div class="alert alert-error large" style="margin-bottom:1.5rem;">
                    <div class="alert-body">
                        <div class="alert-title">Error</div>
                        <div class="alert-message">{{if .Error}}{{.Error}}{{else}}Paste not available — it may have been
                            deleted or already burned after reading.{{end}}</div>
                        <div style="margin-top:1rem;"><a href="/" class="btn btn-primary">Create a new paste</a></div>
                    </div>
                </div>

                {{/* Only show the single content-focused area for missing pastes */}}
                <div class="content-section">
                    <h3>Content</h3>
                    <div class="binary-notice centered large">
                        <p>Paste not available. It may have been deleted or is a burn-after-read paste that has already
                            been accessed.</p>
                        <div class="code-examples" style="margin-top:1rem;">
                            <div class="example">
                                <p>View this paste:</p>
                                <code>curl -sL {{.BaseURL}}/SLUG</code>
                            </div>
                            <div class="example">
                                <p>Download raw content:</p>
                                <code>curl -sL {{.BaseURL}}/raw/SLUG</code>
                            </div>
                        </div>
                    </div>
                </div>

                {{else}}

                <div class="paste-info">
                    <h2>Paste Details</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>ID:</label>
                            <span>{{.Paste.ID}}</span>
                        </div>
                        <div class="info-item">
                            <label>Size:</label>
                            <span>{{.Paste.Size}} bytes</span>
                        </div>
                        <div class="info-item">
                            <label>Type:</label>
                            <span>{{.Paste.ContentType}}</span>
                        </div>
                        <div class="info-item">
                            <label>Created:</label>
                            <span>{{.Paste.CreatedAt.Format "2006-01-02 15:04:05"}}</span>
                        </div>
                        {{if .Paste.ExpiresAt}}
                        <div class="info-item">
                            <label>Expires:</label>
                            <span>{{.Paste.ExpiresAt.Format "2006-01-02 15:04:05"}}</span>
                        </div>
                        {{end}}
                        {{if .Paste.BurnAfterRead}}
                        <div class="info-item burn-notice">
                            <label>⚠️ Burn After Read:</label>
                            <span>This paste will be deleted after viewing</span>
                        </div>
                        {{end}}
                    </div>
                </div>
                <div class="content-section">
                    <div class="action-buttons">
                        <a href="/raw/{{.Paste.ID}}" class="btn btn-secondary" download>Download</a>
                        {{if .IsText}}
                        <button id="copy-content" class="btn btn-secondary">Copy</button>
                        {{end}}
                        <a href="/" class="btn btn-primary">New Paste</a>
                    </div>
                    <h3 style="margin-top: 1.25rem;">Content</h3>
                    {{if .IsText}}
                    <div class="content-display">
                        <pre id="content-text"><code>{{.Content}}</code></pre>
                    </div>
                    {{else}}
                    <div class="binary-notice">
                        <p>This is a binary file. <a href="/raw/{{.Paste.ID}}">Download</a> to view.</p>
                    </div>
                    {{end}}
                </div>
                {{end}}


                <!-- Upload form, hidden by default -->
                <div class="card upload-section" id="upload-section" style="display:none; margin-top:2rem;">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        Paste Content
                    </h2>
                    <div class="form-group">
                        <label for="text-content">Text Content</label>
                        <textarea id="text-content" placeholder="Paste your text here..."></textarea>
                        <div class="form-controls">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="burn-text">
                                <label for="burn-text">Burn after reading</label>
                            </div>
                            <button id="upload-text" class="btn btn-primary">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Paste Text
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="file-input">File Upload</label>
                        <input type="file" id="file-input">
                        <div class="form-controls">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="burn-file">
                                <label for="burn-file">Burn after reading</label>
                            </div>
                            <button id="upload-file" class="btn btn-primary">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Upload File
                            </button>
                        </div>
                    </div>
                </div>
        </main>

        <footer>
            <p>
                NCLIP -
                <a href="https://github.com/johnwmail/nclip" target="_blank" rel="noopener"
                    style="text-decoration: none; color: inherit; font-weight: bold;">
                    Open Source Clipboard Project
                </a><br>
                <small>Version: {{.Version}}</small>
                <!-- BuildTime: {{.BuildTime}} -->
                <!-- CommitHash: {{.CommitHash}} -->
            </p>
        </footer>
    </div>

    <script>
        // Copy content functionality - text only
        document.getElementById('copy-content')?.addEventListener('click', function () {
            const contentText = document.getElementById('content-text');
            if (contentText) {
                const textToCopy = contentText.textContent || contentText.innerText;
                copyTextContent(textToCopy);
            }
        });

        function copyTextContent(text) {
            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function () {
                    showCopySuccess();
                }).catch(function (err) {
                    console.error('Clipboard API failed:', err);
                    fallbackCopy(text);
                });
            } else {
                // Fallback for older browsers or non-HTTPS
                fallbackCopy(text);
            }
        }

        function showCopySuccess() {
            const btn = document.getElementById('copy-content');
            if (btn) {
                btn.textContent = 'Copied!';
                btn.classList.add('btn-success');
                setTimeout(function () {
                    btn.textContent = 'Copy';
                    btn.classList.remove('btn-success');
                }, 2000);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess();
                } else {
                    console.error('Fallback copy failed');
                    alert('Copy failed. Please select and copy manually.');
                }
            } catch (err) {
                console.error('Fallback copy error:', err);
                alert('Copy failed. Please select and copy manually.');
            } finally {
                document.body.removeChild(textArea);
            }
        }
    </script>
</body>

</html>